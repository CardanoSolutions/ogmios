<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.76.5"><meta name=description content="User manual for Ogmios, a lightweight protocol translation service for Cardano."><meta name=author content="KtorZ <matthias.benkort@gmail.com>"><link rel=icon href=/images/favicon.png type=image/png><title>Local Tx Submission - Ogmios</title><link href=/css/nucleus.css?1617464103 rel=stylesheet><link href=/css/fontawesome-all.min.css?1617464103 rel=stylesheet><link href=/css/hybrid.css?1617464103 rel=stylesheet><link href=/css/featherlight.min.css?1617464103 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1617464103 rel=stylesheet><link href=/css/auto-complete.css?1617464103 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1617464103 rel=stylesheet><link href=/css/theme.css?1617464103 rel=stylesheet><link href=/css/hugo-theme.css?1617464103 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1617464103></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/mini-protocols/local-tx-submission/><nav id=sidebar><div id=header-wrapper><div id=header><a href=/><img alt=ogmios src=/ogmios-logo-white.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1617464103></script><script type=text/javascript src=/js/auto-complete.js?1617464103></script><script type=text/javascript>var baseurl="https:\/\/ogmios.dev";</script><script type=text/javascript src=/js/search.js?1617464103></script></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/><b>1. </b>Getting Started</a><ul><li data-nav-id=/getting-started/docker/ title=Docker class=dd-item><a href=/getting-started/docker/>Docker</a></li><li data-nav-id=/getting-started/building/ title=Building class=dd-item><a href=/getting-started/building/>Building</a></li><li data-nav-id=/getting-started/testing/ title=Testing class=dd-item><a href=/getting-started/testing/>Testing</a></li><li data-nav-id=/getting-started/monitoring/ title=Monitoring class=dd-item><a href=/getting-started/monitoring/>Monitoring</a></li><li data-nav-id=/getting-started/basics/ title=Basics class=dd-item><a href=/getting-started/basics/>Basics</a></li></ul></li><li data-nav-id=/mini-protocols/ title="Ouroboros Mini-Protocols" class="dd-item
parent"><a href=/mini-protocols/><b>2. </b>Ouroboros Mini-Protocols</a><ul><li data-nav-id=/mini-protocols/local-chain-sync/ title="Local Chain Sync" class=dd-item><a href=/mini-protocols/local-chain-sync/>Local Chain Sync</a></li><li data-nav-id=/mini-protocols/local-tx-submission/ title="Local Tx Submission" class="dd-item active"><a href=/mini-protocols/local-tx-submission/>Local Tx Submission</a></li><li data-nav-id=/mini-protocols/local-state-query/ title="Local State Query" class=dd-item><a href=/mini-protocols/local-state-query/>Local State Query</a></li></ul></li><li data-nav-id=/deployment/ title=Deployment class=dd-item><a href=/deployment/><b>3. </b>Deployment</a><ul><li data-nav-id=/deployment/aws/ title=AWS class=dd-item><a href=/deployment/aws/>AWS</a></li></ul></li><li data-nav-id=/api-reference/ title="API Reference" class=dd-item><a href=/api-reference/><b>4. </b>API Reference</a></li><li data-nav-id=/changelog/ title=Changelog class=dd-item><a href=/changelog/><b>5. </b>Changelog</a></li></ul><section id=footer><center><a href=https://github.com/KtorZ/cardano-ogmios><i class="fab fa-github" style=font-size:3em></i></a></center></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>Overview</a> > <a href=/mini-protocols/>Ouroboros Mini-Protocols</a> > Local Tx Submission</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#disclaimer>Disclaimer</a></li><li><a href=#how-to-use>How to Use</a></li><li><a href=#full-example>Full Example</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Local Tx Submission</h1><pre style="background:#fff;color:#141414;font-family:courrier new,Courier,monospace;margin:5px;display:inline-block;float:left;border-right:1px dashed #000;margin-right:2em">

 ┌──────────┐
 │   Busy   │◀══════════════════════════════╗      
 └────┬─────┘            SubmitTx           ║      
      │                                     ║      
      │                                ┌──────────┐
      │                                │          │
      │                                │          │
      │          SubmitTxResponse      │   Idle   │
      └───────────────────────────────▶│          │
                                       │          │⇦ START
                                       └──────────┘

</pre><h2 id=overview>Overview</h2><p>Transaction submission is pretty simple & works by submitting an already serialized and signed transaction as one single message.</p><p>In case of success, Ogmios / the node returns an empty response. Otherwise, it returns an error with some details about what went wrong. Clients must thereby know how to construct valid transactions.</p><h2 id=disclaimer>Disclaimer</h2><p>The local tx-submission protocol is the simplest one in appearance. It nevertheless a quite extensive knowledge of the on-chain data-types used by Cardano. Indeed, the protocol in itself is straightforward so long as you already know how to produce and sign a transaction.</p><p>This guide doesn&rsquo;t cover the creation and serialization of Cardano transactions. This is a rather vast topic and there is a handful of tools out there to help on the matter already, in particular:</p><ul><li><p><a href=https://github.com/Emurgo/cardano-serialization-lib>cardano-serialization-lib</a> which gives JavaScript and WASM bindings for every Cardano on-chain types.</p></li><li><p><a href=https://github.com/input-output-hk/cardano-transactions/>cardano-transactions</a> which offers a Haskell library and a command-line interface for constructing and signing transactions.</p></li><li><p><a href=https://github.com/input-output-hk/cardano-node/tree/master/cardano-cli>cardano-cli</a> which offers another command-line interface for constructing and signing transactions.</p></li></ul><p>In any case, one can always refer to the source <a href=https://github.com/input-output-hk/cardano-ledger-specs/blob/d6179d72c52588460c1d57b932a2fd0724c5db32/shelley/chain-and-ledger/shelley-spec-ledger-test/cddl-files/shelley.cddl>CDDL specifications</a> to know how to construct and serialize Cardano transactions.</p><div class="notices info"><p>Providing a more user-friendly interface with regards to transactions in Ogmios is still under consideration. Yet, since in order to handle and sign transactions, one needs some knowledge about the on-chain binary format anyway, I&rsquo;ve made the (effortless) choice to only treat with already serialized blobs in Ogmios. I am open to suggestions about how this could be made better, drop me a message on Github if you have ideas!</p></div><h2 id=how-to-use>How to Use</h2><p>Sending a transaction through the Cardano network requires one message using the method <code>SubmitTx</code>, and with a single mandatory arguments with <code>bytes</code>, representing a serialized signed transactions with its full witness.</p><p>Note that JSON does not support embedding raw bytes in objects. Bytes needs therefore to be encoded in either <code>Base16</code> or <code>Base64</code>; Ogmios will try both encoding.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{ 
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;jsonwsp/request&#34;</span>,
    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>,
    <span style=color:#f92672>&#34;servicename&#34;</span>: <span style=color:#e6db74>&#34;ogmios&#34;</span>,
    <span style=color:#f92672>&#34;methodname&#34;</span>: <span style=color:#e6db74>&#34;SubmitTx&#34;</span>,
    <span style=color:#f92672>&#34;args&#34;</span>: { <span style=color:#f92672>&#34;bytes&#34;</span>: <span style=color:#e6db74>&#34;&lt;base16 or base64&gt;&#34;</span> }
}
</code></pre></div><p>The response will indicate either a <code>SubmitSuccess</code> or <code>SubmitFail</code>. In case of failure, Ogmios will return a list of failures reported by the underlying node. Note that, if the transaction fails to parse, Ogmios will reply with a generic error.</p><p>Transactions in Shelley are rather <em>complicated</em> and there is <strong>a lot of</strong> possible validation errors that can be returned. Be sure to have a look at the <a href=../../api-reference>API reference</a> for an exhaustive list.</p><h2 id=full-example>Full Example</h2><p>For what it&rsquo;s worth, here&rsquo;s an example of a transaction submission to the Cardano mainnet via Ogmios. This transaction is using dummy data and will obviously fail. It is however structurally valid, so useful to test if an integration works correctly.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WebSocket</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ws&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#34;ws://localhost:1337&#34;</span>);

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>wsp</span>(<span style=color:#a6e22e>methodname</span>, <span style=color:#a6e22e>args</span>) {
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jsonwsp/request&#34;</span>,
        <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1.0&#34;</span>,
        <span style=color:#a6e22e>servicename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ogmios&#34;</span>,
        <span style=color:#a6e22e>methodname</span>,
        <span style=color:#a6e22e>args</span>
    }));
}

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>once</span>(<span style=color:#e6db74>&#39;open&#39;</span>, () =&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span>
      <span style=color:#e6db74>&#34;g6QAgYJYIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGCglg5AQEBAQEBAQEB&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBGgAehICC&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;WDkBAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;AgICAgIaAHgXXAIaAAH6pAMZHkahAIGCWCABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;AAAAAFhA169grjPSrzUUEcFEXHlZBSaZC/pzy7NzK1TvMi2qFC5ohAI0EPi+PBbpvVIHbyuz&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;a/ON/gNKnwRljp9WGXq4D/Y=&#34;</span>;

    <span style=color:#a6e22e>wsp</span>(<span style=color:#e6db74>&#34;SubmitTx&#34;</span>, { <span style=color:#a6e22e>bytes</span> });
});

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;message&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>msg</span>) {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>msg</span>);
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>response</span>);
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>close</span>();
});
</code></pre></div><p>Ogmios replies negatively to the request, returning 4 errors reported by the ledger. Yet, this was indeed reported by the ledger itself, amazing isn&rsquo;t it?</p><div class=expand><div class=expand-label style=cursor:pointer onclick="$h=$(this);$h.next('div').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('div').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right';});});"><i style=font-size:x-small class="fas fa-chevron-right"></i><span>SubmitFail</span></div><div class=expand-content style=display:none><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>,
  <span style=color:#f92672>&#34;servicename&#34;</span>: <span style=color:#e6db74>&#34;ogmios&#34;</span>,
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;jsonwsp/response&#34;</span>,
  <span style=color:#f92672>&#34;methodname&#34;</span>: <span style=color:#e6db74>&#34;SubmitTx&#34;</span>,
  <span style=color:#f92672>&#34;result&#34;</span>: {
    <span style=color:#f92672>&#34;SubmitTxResponse&#34;</span>: {
      <span style=color:#f92672>&#34;error&#34;</span>: {
        <span style=color:#f92672>&#34;SubmitFail&#34;</span>: [
          {
            <span style=color:#f92672>&#34;expiredUtxo&#34;</span>: {
              <span style=color:#f92672>&#34;transactionTimeToLive&#34;</span>: <span style=color:#ae81ff>7750</span>,
              <span style=color:#f92672>&#34;currentSlot&#34;</span>: <span style=color:#ae81ff>12588967</span>
            }
          },
          {
            <span style=color:#f92672>&#34;feeTooSmall&#34;</span>: {
              <span style=color:#f92672>&#34;requiredFee&#34;</span>: <span style=color:#ae81ff>168009</span>,
              <span style=color:#f92672>&#34;actualFee&#34;</span>: <span style=color:#ae81ff>129700</span>
            }
          },
          {
            <span style=color:#f92672>&#34;badInputs&#34;</span>: [
              {
                <span style=color:#f92672>&#34;index&#34;</span>: <span style=color:#ae81ff>0</span>,
                <span style=color:#f92672>&#34;txId&#34;</span>: <span style=color:#e6db74>&#34;0000000000000000000000000000000000000000000000000000000000000000&#34;</span>
              }
            ]
          },
          {
            <span style=color:#f92672>&#34;valueNotConserved&#34;</span>: {
              <span style=color:#f92672>&#34;consumed&#34;</span>: <span style=color:#ae81ff>0</span>,
              <span style=color:#f92672>&#34;produced&#34;</span>: <span style=color:#ae81ff>10000000</span>
            }
          }
        ]
      }
    }
  },
  <span style=color:#f92672>&#34;reflection&#34;</span>: <span style=color:#66d9ef>null</span>
}
</code></pre></div></div></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/mini-protocols/local-chain-sync/ title="Local Chain Sync"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/mini-protocols/local-state-query/ title="Local State Query" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1617464103></script><script src=/js/perfect-scrollbar.min.js?1617464103></script><script src=/js/perfect-scrollbar.jquery.min.js?1617464103></script><script src=/js/jquery.sticky.js?1617464103></script><script src=/js/featherlight.min.js?1617464103></script><script src=/js/highlight.pack.js?1617464103></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1617464103></script><script src=/js/learn.js?1617464103></script><script src=/js/hugo-learn.js?1617464103></script></body></html>