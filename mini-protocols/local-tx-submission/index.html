<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.76.5"><meta name=description content="User manual for Ogmios, a lightweight protocol translation service for Cardano."><meta name=author content="KtorZ <matthias.benkort@gmail.com>"><link rel=icon href=/images/favicon.png type=image/png><title>Transaction submission - Ogmios</title><link href=/css/nucleus.css?1690559420 rel=stylesheet><link href=/css/fontawesome-all.min.css?1690559420 rel=stylesheet><link href=/css/hybrid.css?1690559420 rel=stylesheet><link href=/css/featherlight.min.css?1690559420 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1690559420 rel=stylesheet><link href=/css/auto-complete.css?1690559420 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1690559420 rel=stylesheet><link href=/css/theme.css?1690559420 rel=stylesheet><link href=/css/tabs.css?1690559420 rel=stylesheet><link href=/css/hugo-theme.css?1690559420 rel=stylesheet><link href=/css/theme-mine.css?1690559420 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1690559420></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/mini-protocols/local-tx-submission/><nav id=sidebar><div id=header-wrapper><div id=header><a href=/><img alt=ogmios src=/ogmios__light.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1690559420></script><script type=text/javascript src=/js/auto-complete.js?1690559420></script><script type=text/javascript>var baseurl="https:\/\/ogmios.dev";</script><script type=text/javascript src=/js/search.js?1690559420></script></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting started" class=dd-item><a href=/getting-started/><b>1. </b>Getting started</a><ul><li data-nav-id=/getting-started/docker/ title=Docker class=dd-item><a href=/getting-started/docker/>Docker</a></li><li data-nav-id=/getting-started/building/ title=Building class=dd-item><a href=/getting-started/building/>Building</a></li><li data-nav-id=/getting-started/testing/ title=Testing class=dd-item><a href=/getting-started/testing/>Testing</a></li><li data-nav-id=/getting-started/monitoring/ title=Monitoring class=dd-item><a href=/getting-started/monitoring/>Monitoring</a></li><li data-nav-id=/getting-started/basics/ title=Basics class=dd-item><a href=/getting-started/basics/>Basics</a></li></ul></li><li data-nav-id=/mini-protocols/ title=Mini-Protocols class="dd-item
parent"><a href=/mini-protocols/><b>2. </b>Mini-Protocols</a><ul><li data-nav-id=/mini-protocols/local-chain-sync/ title="Chain synchronization" class=dd-item><a href=/mini-protocols/local-chain-sync/>Chain synchronization</a></li><li data-nav-id=/mini-protocols/local-state-query/ title="Ledger state queries" class=dd-item><a href=/mini-protocols/local-state-query/>Ledger state queries</a></li><li data-nav-id=/mini-protocols/local-tx-submission/ title="Transaction submission" class="dd-item active"><a href=/mini-protocols/local-tx-submission/>Transaction submission</a></li><li data-nav-id=/mini-protocols/local-tx-monitor/ title="Mempool monitoring" class=dd-item><a href=/mini-protocols/local-tx-monitor/>Mempool monitoring</a></li></ul></li><li data-nav-id=/clients/ title=Clients class=dd-item><a href=/clients/><b>3. </b>Clients</a></li><li data-nav-id=/api/ title="API Reference" class=dd-item><a href=/api/><b>4. </b>API Reference</a></li><li data-nav-id=/changelog/ title=Changelog class=dd-item><a href=/changelog/><b>5. </b>Changelog</a></li><li data-nav-id=/faq/ title=F.A.Q class=dd-item><a href=/faq/><b>6. </b>F.A.Q</a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/cardanosolutions/ogmios><i class="fab fa-github"></i>Source code</a></li><li><a class=padding href=https://github.com/cardanosolutions/ogmios/issues><i class="fas fa-solid fa-bullseye"></i>Issues Tracking</a></li><li><a class=padding href=https://discord.gg/ZeyDn65t5v><i class="fab fa-discord"></i>Discord (#ogmios)</a></li><li><a class=padding href=https://github.com/CardanoSolutions/ogmios/tree/master/architectural-decisions/accepted><i class="fas fa-solid fa-file-code"></i>Architectural Decisions Record</a></li></ul></section><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>Overview</a> > <a href=/mini-protocols/>Mini-Protocols</a> > Transaction submission</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#disclaimer>Disclaimer</a></li><li><a href=#submitting-transactions>Submitting transactions</a></li><li><a href=#evaluating-transactions>Evaluating transactions</a><ul><li><a href=#additional-utxo-set>Additional UTXO Set</a></li></ul></li><li><a href=#full-example>Full Example</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Transaction submission</h1><div class="ascii-drawing ascii-drawing-split"><pre style=font-family:monospace> 
                        submitTransaction
                     ╭────────╮
         START       │        │
           ⇓         │        │
        ┌────────────┴───┐    │
 ╭──────┤      Idle      │◀───╯
 │      └────────────────┘
 │        ▲
 │        │
 ╰────────╯
    evaluateTransaction
 </pre></div><h2 id=overview>Overview</h2><p>Transaction submission is pretty simple & works by submitting an already serialized and signed transaction as one single message.</p><p>In case of success, Ogmios / the node returns an empty response. Otherwise, it returns an error with some details about what went wrong. Clients must thereby know how to construct valid transactions.</p><h2 id=disclaimer>Disclaimer</h2><p>The transaction submission protocol is the simplest one in appearance. It nevertheless requires a quite extensive knowledge of the on-chain data-types used by Cardano. Indeed, the protocol in itself is straightforward so long as you already know how to produce and sign a transaction.</p><p>This guide doesn&rsquo;t cover the creation and serialization of Cardano transactions. This is a rather vast topic and there is a handful of tools out there to help on the matter already, in particular:</p><ul><li><p><a href=https://lucid.spacebudz.io/>Lucid</a>, a TypeScript / Deno package for building transaction and managing credentials. It has direct integration into Ogmios.</p></li><li><p><a href=https://meshjs.dev/>Mesh.js</a>, a JavaScript library providing numerous tools to easily build powerful dApps on the Cardano blockchain.</p></li><li><p><a href=https://github.com/input-output-hk/cardano-node/tree/master/cardano-cli>cardano-cli</a> which offers another command-line interface for constructing and signing transactions.</p></li></ul><p>In any case, one can always refer to the source <a href=https://github.com/input-output-hk/cardano-ledger/blob/5af4f68486680bf73ba21a9620a14e128e9fe5f7/eras/babbage/test-suite/cddl-files/babbage.cddl>CDDL specifications</a> to know how to construct and serialize Cardano transactions.</p><div class="notices info"><p>Providing a more user-friendly interface with regards to transactions in Ogmios is still under consideration. Yet, since in order to handle and sign transactions, one needs some knowledge about the on-chain binary format anyway, I&rsquo;ve made the (effortless) choice to only treat with already serialized blobs in Ogmios. I am open to suggestions about how this could be made better, drop me a message on Github if you have ideas!</p></div><h2 id=submitting-transactions>Submitting transactions</h2><p>Sending a transaction through the Cardano network requires one message using the method <code>SubmitTx</code>, and with a single mandatory arguments with <code>bytes</code>, representing a serialized signed transactions with its full witness.</p><p>Note that JSON does not support embedding raw bytes in objects. Bytes needs therefore to be base16-encoded.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
    <span style=color:#f92672>&#34;method&#34;</span>: <span style=color:#e6db74>&#34;submitTransaction&#34;</span>,
    <span style=color:#f92672>&#34;params&#34;</span>: { <span style=color:#f92672>&#34;transaction&#34;</span>: { <span style=color:#f92672>&#34;cbor&#34;</span>: { <span style=color:#f92672>&#34;&lt;base16&gt;&#34;</span> } } }
}
</code></pre></div><p>The response will indicate either a success or a failure. In case of failure, Ogmios will return a list of failures reported by the underlying node. Note that, if the transaction fails to parse, Ogmios will reply with a generic error.</p><p>Transactions in Cardano are rather <em>complicated</em> and there are <strong>a lot of</strong> possible validation errors that can be returned. Be sure to have a look at the <a href=../../api>API reference</a> for an exhaustive list.</p><h2 id=evaluating-transactions>Evaluating transactions</h2><p>Starting from <a href=https://github.com/CardanoSolutions/ogmios/releases/tag/v5.2.0><code>5.2.0</code></a>, Ogmios supports a modified version of the transaction submission protocol that allows to evaluate the execution units of scripts present in a given transaction, <strong>without actually submitting the transaction</strong>. This is useful for DApp developers who wants a quick-and-easy way to measure script execution costs.</p><p>The API is purposely similar to the <code>submitTransaction</code> method, with a few semantic changes:</p><ul><li>The transaction needs not to be fully authenticated. Key witnesses may be omitted unless they are relevant to the evaluation of scripts themselves!</li><li>The transaction needs not to be balanced; indeed, the evaluation does not perform a full execution of all the ledger rules. So while the transaction must be well-formed, it may be <em>invalid</em> with regards to phase-1 validations.</li><li>Execution budgets assigned to redeemers are expected to be set to zero since the goal of this endpoint is to figure out these very execution budgets.</li></ul><p>From there, the endpoint works similarly to the submission:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
    <span style=color:#f92672>&#34;method&#34;</span>: <span style=color:#e6db74>&#34;evaluateTransaction&#34;</span>,
    <span style=color:#f92672>&#34;params&#34;</span>: { <span style=color:#f92672>&#34;transaction&#34;</span>: { <span style=color:#f92672>&#34;cbor&#34;</span>: <span style=color:#e6db74>&#34;&lt;base16&gt;&#34;</span> } }
}
</code></pre></div><p>Successful responses include a map of <a href><em>redeemer pointers</em></a> with the corresponding execution units. A redeemer pointer is a key composed of two parts: a <em>redeemer entity tag</em> and a 0-based index related to that entity. There exists 4 kinds of redeemer entities: <code>spend</code> (for transaction inputs), <code>certificate</code> (for transaction certificates), <code>mint</code> (for transaction monetary policies) and <code>withdrawal</code> (for transaction&rsquo;s rewards withdrawals). The index therefore refers to the position of the script-locked entity within the set of entities in the transaction.</p><p>For example <code>spend:0</code> points to the first transaction input; <code>mint:2</code> would point to the 3rd policy referenced in the minting map&mldr; and so forth. Here below is a JSON example of an evaluation result:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
  <span style=color:#f92672>&#34;result&#34;</span>: {
    <span style=color:#f92672>&#34;budgets&#34;</span>: {
      <span style=color:#f92672>&#34;spend:0&#34;</span>: {
        <span style=color:#f92672>&#34;memory&#34;</span>: <span style=color:#ae81ff>1700</span>,
        <span style=color:#f92672>&#34;cpu&#34;</span>: <span style=color:#ae81ff>476468</span>
      }
    }
  }
}
</code></pre></div><p>See the <a href=/api/modules/_cardano_ogmios_client.TxSubmission.evaluationErrors.html>full API reference</a> for details about possible errors returned from this endpoint.</p><div class="notices warning"><p>If you&rsquo;re using typed Plutus validators (if you don&rsquo;t know what that is, then it is most likely what you&rsquo;re using), keep in mind that <strong>adding or removing elements</strong> to and off your transaction <strong>will change its execution cost</strong>. Indeed, the creation of the script context passed down to on-chain validators is done as part of the on-chain validator execution. Thus, <strong>larger contexts require more execution units!</strong><br><br>This is the case for instance when you add a change output to a transaction or, a script integrity hash. A generally good way to approach this problem is to either:<br><br><strong>1.</strong> make sure that the transaction you evaluate is as close as possible to the final transaction; that is, create dummy change outputs and script integrity hash before evaluating and fill-in their actual value once evaluated;<br><strong>2.</strong> keep some safe margin from the evaluated execution units; Execution units are relatively cheap on Cardano so, an extra 5 or 10% isn&rsquo;t much and saves you in most cases a lot of hassle to cope with small differences.</p></div><h3 id=additional-utxo-set>Additional UTXO Set</h3><p>In order to construct the validator script context, Ogmios needs to resolve transaction inputs from the Cardano blockchain. In case where a submitted transaction refers to non-existing inputs, the evaluation will fail with an <a href=/api/modules/_cardano_ogmios_client.TxSubmission.evaluationErrors.html#UnknownInputs>UnknownInputs</a> error. This can be an obstacle during development or, in scenarios where transactions are being prepared ahead of UTXO.</p><p>In such scenarios, Ogmios gives way to provide an <em>additional UTXO set</em> to be used during evaluation. Note that it will still try to resolve inputs that are known, but will use the provided UTXO set as a complement for those that are unknown or yet-to-know.</p><div class="notices tip"><p>The <a href=/api/modules/_cardano_ogmios_schema.html#Utxo>structure of the additional UTXO set</a> is the same as UTXO sets returned in other part of the Ogmios' API; that is, an array of <code>[OutputReference, Output]</code> tuples.</p></div><p>For example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
    <span style=color:#f92672>&#34;method&#34;</span>: <span style=color:#e6db74>&#34;evaluateTransaction&#34;</span>,
    <span style=color:#f92672>&#34;params&#34;</span>: {
      <span style=color:#f92672>&#34;transaction&#34;</span>: {
        <span style=color:#f92672>&#34;cbor&#34;</span>: <span style=color:#e6db74>&#34;&lt;base16&gt;&#34;</span>,
      },
      <span style=color:#f92672>&#34;additionalUtxoSet&#34;</span>: [
        [
          {
            <span style=color:#f92672>&#34;transaction&#34;</span>: { <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;97b2af6dfc6a4825e934146f424cdd6ede43ff98c355d2ae3aa95b0f70b63949&#34;</span> },
            <span style=color:#f92672>&#34;output&#34;</span>: { <span style=color:#f92672>&#34;index&#34;</span>: <span style=color:#ae81ff>3</span> }
          },
          {
            <span style=color:#f92672>&#34;address&#34;</span>: <span style=color:#e6db74>&#34;addr_test1qp9zjnc775anpndl0jh3w7vyy25syfezf70d&#34;</span>,
            <span style=color:#f92672>&#34;value&#34;</span>: { <span style=color:#f92672>&#34;lovelace&#34;</span>: <span style=color:#ae81ff>10000000</span> }
          }
        ]
      ]
    }
}
</code></pre></div><h2 id=full-example>Full Example</h2><p>For what it&rsquo;s worth, here&rsquo;s an example of a transaction submission to the Cardano mainnet via Ogmios. This transaction is using dummy data and will obviously fail. It is however structurally valid, so useful to test if an integration works correctly.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WebSocket</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ws&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#34;ws://localhost:1337&#34;</span>);

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>rpc</span>(<span style=color:#a6e22e>method</span>, <span style=color:#a6e22e>params</span>) {
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
        <span style=color:#a6e22e>jsonrpc</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;2.0&#34;</span>,
        <span style=color:#a6e22e>method</span>,
        <span style=color:#a6e22e>params</span>
    }));
}

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>once</span>(<span style=color:#e6db74>&#39;open&#39;</span>, () =&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cbor</span> <span style=color:#f92672>=</span>
      <span style=color:#e6db74>&#34;83a4008182582000000000000000000000000000000000000000000000000000&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;0000000000000000018282583901010101010101010101010101010101010101&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;0101010101010101010101010101010101010101010101010101010101010101&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;0101010101011a001e8480825839010202020202020202020202020202020202&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;0202020202020202020202020202020202020202020202020202020202020202&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;020202020202021a0078175c021a0001faa403191e46a1008182582001000000&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;000000000000000000000000000000000000000000000000000000005840d7af&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;60ae33d2af351411c1445c79590526990bfa73cbb3732b54ef322daa142e6884&#34;</span><span style=color:#f92672>+</span>
      <span style=color:#e6db74>&#34;023410f8be3c16e9bd52076f2bb36bf38dfe034a9f04658e9f56197ab80ff6&#34;</span>;

    <span style=color:#a6e22e>rpc</span>(<span style=color:#e6db74>&#34;submitTransaction&#34;</span>, { <span style=color:#a6e22e>transaction</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>cbor</span> } });
});

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;message&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>msg</span>) {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>msg</span>);
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>response</span>);
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>close</span>();
});
</code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/mini-protocols/local-state-query/ title="Ledger state queries"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/mini-protocols/local-tx-monitor/ title="Mempool monitoring" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1690559420></script><script src=/js/perfect-scrollbar.min.js?1690559420></script><script src=/js/perfect-scrollbar.jquery.min.js?1690559420></script><script src=/js/jquery.sticky.js?1690559420></script><script src=/js/featherlight.min.js?1690559420></script><script src=/js/highlight.pack.js?1690559420></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1690559420></script><script src=/js/learn.js?1690559420></script><script src=/js/hugo-learn.js?1690559420></script></body></html>