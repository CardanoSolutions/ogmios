<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.76.5"><meta name=description content="User manual for Ogmios, a lightweight protocol translation service for Cardano."><meta name=author content="KtorZ <matthias.benkort@gmail.com>"><link rel=icon href=/images/favicon.png type=image/png><title>Local State Query - Ogmios</title><link href=/css/nucleus.css?1627970201 rel=stylesheet><link href=/css/fontawesome-all.min.css?1627970201 rel=stylesheet><link href=/css/hybrid.css?1627970201 rel=stylesheet><link href=/css/featherlight.min.css?1627970201 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1627970201 rel=stylesheet><link href=/css/auto-complete.css?1627970201 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1627970201 rel=stylesheet><link href=/css/theme.css?1627970201 rel=stylesheet><link href=/css/hugo-theme.css?1627970201 rel=stylesheet><link href=/css/theme-mine.css?1627970201 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1627970201></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/mini-protocols/local-state-query/><nav id=sidebar><div id=header-wrapper><div id=header><a href=/><img alt=ogmios src=/ogmios-logo-white.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1627970201></script><script type=text/javascript src=/js/auto-complete.js?1627970201></script><script type=text/javascript>var baseurl="https:\/\/ogmios.dev";</script><script type=text/javascript src=/js/search.js?1627970201></script></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/><b>1. </b>Getting Started</a><ul><li data-nav-id=/getting-started/docker/ title=Docker class=dd-item><a href=/getting-started/docker/>Docker</a></li><li data-nav-id=/getting-started/building/ title=Building class=dd-item><a href=/getting-started/building/>Building</a></li><li data-nav-id=/getting-started/testing/ title=Testing class=dd-item><a href=/getting-started/testing/>Testing</a></li><li data-nav-id=/getting-started/monitoring/ title=Monitoring class=dd-item><a href=/getting-started/monitoring/>Monitoring</a></li><li data-nav-id=/getting-started/basics/ title=Basics class=dd-item><a href=/getting-started/basics/>Basics</a></li></ul></li><li data-nav-id=/mini-protocols/ title="Ouroboros Mini-Protocols" class="dd-item
parent"><a href=/mini-protocols/><b>2. </b>Ouroboros Mini-Protocols</a><ul><li data-nav-id=/mini-protocols/local-chain-sync/ title="Local Chain Sync" class=dd-item><a href=/mini-protocols/local-chain-sync/>Local Chain Sync</a></li><li data-nav-id=/mini-protocols/local-state-query/ title="Local State Query" class="dd-item active"><a href=/mini-protocols/local-state-query/>Local State Query</a></li><li data-nav-id=/mini-protocols/local-tx-submission/ title="Local Tx Submission" class=dd-item><a href=/mini-protocols/local-tx-submission/>Local Tx Submission</a></li></ul></li><li data-nav-id=/deployment/ title=Deployment class=dd-item><a href=/deployment/><b>4. </b>Deployment</a><ul><li data-nav-id=/deployment/aws/ title=AWS class=dd-item><a href=/deployment/aws/>AWS</a></li></ul></li><li data-nav-id=/typescript-client/ title="TypeScript Client" class=dd-item><a href=/typescript-client/><b>3. </b>TypeScript Client</a><ul><li data-nav-id=/typescript-client/overview/ title=Overview class=dd-item><a href=/typescript-client/overview/>Overview</a></li><li data-nav-id=/typescript-client/chain-sync/ title="ChainSync Client" class=dd-item><a href=/typescript-client/chain-sync/>ChainSync Client</a></li><li data-nav-id=/typescript-client/state-query/ title="StateQuery Client" class=dd-item><a href=/typescript-client/state-query/>StateQuery Client</a></li><li data-nav-id=/typescript-client/tx-submission/ title="TxSubmission Client" class=dd-item><a href=/typescript-client/tx-submission/>TxSubmission Client</a></li></ul></li><li data-nav-id=/api-reference/ title="API Reference" class=dd-item><a href=/api-reference/><b>5. </b>API Reference</a></li><li data-nav-id=/changelog/ title=Changelog class=dd-item><a href=/changelog/><b>6. </b>Changelog</a></li><li data-nav-id=/faq/ title=F.A.Q class=dd-item><a href=/faq/><b>7. </b>F.A.Q</a></li></ul><section id=footer><center><a href=https://github.com/cardanosolutions/ogmios><i class="fab fa-github" style=font-size:3em></i></a></center></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>Overview</a> > <a href=/mini-protocols/>Ouroboros Mini-Protocols</a> > Local State Query</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#how-to-use>How To Use</a></li><li><a href=#acquire>Acquire</a></li><li><a href=#query>Query</a></li><li><a href=#simplified-example>Simplified Example</a></li><li><a href=#full-example>Full Example</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Local State Query</h1><div class="ascii-drawing ascii-drawing-split"><pre> 
                ┌───────────────┐
        ┌──────▶│     Idle      │⇦ START
        │       └───┬───────────┘
        │           │       ▲ 
        │   Acquire │       │ Failure 
        │           ▼       │
        │       ┌───────────┴───┐                   
Release │       │   Acquiring   │◀─────────────────┐
        │       └───┬───────────┘                  │
        │           │       ▲                      │ Result 
        │  Acquired │       │ ReAcquire            │
        │           ▼       │                      │
        │       ┌───────────┴───┐         ┌────────┴───────┐
        └───────┤   Acquired    │────────▶│    Querying    │
                └───────────────┘  Query  └────────────────┘
 </pre></div><h2 id=overview>Overview</h2><p>The state query protocol is likely the most versatile of the three Ouroboros mini-protocols. As a matter of fact, it allows for querying various types of information directly from the ledger. In essence, it is like a very simpler request/response pattern where the types of questions one can ask are specified by the protocols. Those questions include: information about the chain tip, information about stake pools but also the balance of a particular address.</p><p>In order to run a question by the ledger, one must first acquire a particular position on the chain, so that the node can reliably answer a few questions on a chosen, frozen state while continuing maintaining more recent version of the ledger on the side. It is important to note that:</p><ol><li><p>The node cannot acquire any arbitrary state. One can only rewind up to a certain point.</p></li><li><p>Should a client keep a state acquired for too long, it is likely to become unreachable at some point, forcing clients to re-acquire.</p></li></ol><h2 id=how-to-use>How To Use</h2><p>Ogmios uses a simplified version of the above state-machine. Or more exactly, it exposes a simplified version and handles some of the complexity behind the scene for you. As clients, Ogmios will give you 3 possible requests: Acquire, Query, Release. A typical sequence would be to start by Acquiring a state on a given point and then make a few queries, and then release. The release step is optional although it is a bit more polite to say goodbye at the end of a conversation.</p><p>It is also possible to submit queries directly without acquiring. As a consequence, Ogmios will acquire the tip of the chain, run the query and release it for you. This is the easiest way to send
queries if you don&rsquo;t care about capturing a particular state. Note however that this may create race conditions if you send multiple queries via this method. Indeed, the tip is changing quite often on the network, and two subsequent queries may actually run on two different points of the chain. While this is generally safe for most queries, it may also put your application in an unexpected state when crossing epoch boundaries or hard-forks.</p><h2 id=acquire>Acquire</h2><p>The <code>Acquire</code> request expect one argument named <code>point</code>. The point has the same format as points in the local-chain-sync protocol. That is, they can be block header hashes or the special keyword <code>"origin"</code> (though there&rsquo;s very little chance that one will be able to acquire the origin!).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{ 
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;jsonwsp/request&#34;</span>,
    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>,
    <span style=color:#f92672>&#34;servicename&#34;</span>: <span style=color:#e6db74>&#34;ogmios&#34;</span>,
    <span style=color:#f92672>&#34;methodname&#34;</span>: <span style=color:#e6db74>&#34;Acquire&#34;</span>,
    <span style=color:#f92672>&#34;args&#34;</span>: { <span style=color:#f92672>&#34;point&#34;</span>: <span style=color:#e6db74>&#34;9e871633f7aa356ef11cdcabb6fdd6d8f4b00bc919c57aed71a91af8f86df590&#34;</span> }
}
</code></pre></div><p>One thing that doesn&rsquo;t strike as obvious is that, as clients, you need points to query any information. There are many ways to get those hashes but in the context of Ogmios, the most logical way is via the <a href=../local-chain-sync/>local-chain-sync</a> protocol.</p><div class="notices tip"><p>You can acquire multiple times, the last one will prevail. If you need to re-acquire, simply send another <code>Acquire</code> request.</p></div><h2 id=query>Query</h2><p>There are many queries that can be sent to the ledger, and the list is growing days after days as the Cardano team implements new ones. With Ogmios, all queries follow the same pattern and use the method name <code>Query</code>. All of them also take one argument named <code>query</code> which specifies the query to run and, optionally some extra argument given to the query. For example:</p><pre><code>{ 
    &quot;type&quot;: &quot;jsonwsp/request&quot;,
    &quot;version&quot;: &quot;1.0&quot;,
    &quot;servicename&quot;: &quot;ogmios&quot;,
    &quot;methodname&quot;: &quot;Query&quot;,
    &quot;args&quot;: { &quot;query&quot;: &quot;ledgerTip&quot; }
}
</code></pre><p>At the moment of writing this guide, the following queries are available:</p><table><thead><tr><th>Query</th><th>Result</th></tr></thead><tbody><tr><td><code>eraStart</code></td><td>The information regarding the beginning of the current era.</td></tr><tr><td><code>ledgerTip</code></td><td>The most recent block tip known of the ledger.</td></tr><tr><td><code>currentEpoch</code></td><td>The current epoch of the ledger.</td></tr><tr><td><code>nonMyopicMemberRewards</code></td><td>Non-myopic member rewards for each pool. Used in ranking.</td></tr><tr><td><code>delegationsAndRewards</code></td><td>Current delegation settings and rewards of given reward accounts.</td></tr><tr><td><code>currentProtocolParameters</code></td><td>The current protocol parameters.</td></tr><tr><td><code>proposedProtocolParameters</code></td><td>The last update proposal w.r.t. protocol parameters, if any.</td></tr><tr><td><code>stakeDistribution</code></td><td>Distribution of the stake across all known stake pools.</td></tr><tr><td><code>utxo</code></td><td>Current UTxO, possibly filtered by address.</td></tr><tr><td><code>genesisConfig</code></td><td>Get a compact version of the era&rsquo;s genesis configuration.</td></tr></tbody></table><p>To know more about arguments and results of each query, have a look at the <a href=../../api-reference>API reference</a>.</p><h2 id=simplified-example>Simplified Example</h2><p>In this example, we&rsquo;ll consider a simple direct query on the network tip to fetch the latest protocol parameters. The next section gives a more elaborate example which shows how to acquire a specific point on chain.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WebSocket</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ws&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#34;ws://localhost:1337&#34;</span>);

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>wsp</span>(<span style=color:#a6e22e>methodname</span>, <span style=color:#a6e22e>args</span>) {
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jsonwsp/request&#34;</span>,
        <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1.0&#34;</span>,
        <span style=color:#a6e22e>servicename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ogmios&#34;</span>,
        <span style=color:#a6e22e>methodname</span>,
        <span style=color:#a6e22e>args</span>
    }));
}

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>once</span>(<span style=color:#e6db74>&#39;open&#39;</span>, () =&gt; {
    <span style=color:#a6e22e>wsp</span>(<span style=color:#e6db74>&#34;Query&#34;</span>, { <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;currentProtocolParameters&#34;</span> } );
});

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;message&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>msg</span>) {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>msg</span>);
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>result</span>, <span style=color:#66d9ef>null</span>, <span style=color:#ae81ff>4</span>));
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>close</span>();
});
</code></pre></div><p>This little excerpt outputs the most recent protocol parameters in a nice JSON:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;poolDeposit&#34;</span>: <span style=color:#ae81ff>500000000</span>,
    <span style=color:#f92672>&#34;protocolVersion&#34;</span>: {
        <span style=color:#f92672>&#34;minor&#34;</span>: <span style=color:#ae81ff>0</span>,
        <span style=color:#f92672>&#34;major&#34;</span>: <span style=color:#ae81ff>3</span>
    },
    <span style=color:#f92672>&#34;minUtxoValue&#34;</span>: <span style=color:#ae81ff>1000000</span>,
    <span style=color:#f92672>&#34;minFeeConstant&#34;</span>: <span style=color:#ae81ff>155381</span>,
    <span style=color:#f92672>&#34;maxTxSize&#34;</span>: <span style=color:#ae81ff>16384</span>,
    <span style=color:#f92672>&#34;minPoolCost&#34;</span>: <span style=color:#ae81ff>340000000</span>,
    <span style=color:#f92672>&#34;maxBlockBodySize&#34;</span>: <span style=color:#ae81ff>65536</span>,
    <span style=color:#f92672>&#34;extraEntropy&#34;</span>: <span style=color:#e6db74>&#34;neutral&#34;</span>,
    <span style=color:#f92672>&#34;minFeeCoefficient&#34;</span>: <span style=color:#ae81ff>44</span>,
    <span style=color:#f92672>&#34;poolInfluence&#34;</span>: <span style=color:#e6db74>&#34;3/10&#34;</span>,
    <span style=color:#f92672>&#34;maxBlockHeaderSize&#34;</span>: <span style=color:#ae81ff>1100</span>,
    <span style=color:#f92672>&#34;stakeKeyDeposit&#34;</span>: <span style=color:#ae81ff>2000000</span>,
    <span style=color:#f92672>&#34;decentralizationParameter&#34;</span>: <span style=color:#e6db74>&#34;1/5&#34;</span>,
    <span style=color:#f92672>&#34;desiredNumberOfPools&#34;</span>: <span style=color:#ae81ff>500</span>,
    <span style=color:#f92672>&#34;poolRetirementEpochBound&#34;</span>: <span style=color:#ae81ff>18</span>,
    <span style=color:#f92672>&#34;monetaryExpansion&#34;</span>: <span style=color:#e6db74>&#34;3/1000&#34;</span>,
    <span style=color:#f92672>&#34;treasuryExpansion&#34;</span>: <span style=color:#e6db74>&#34;1/5&#34;</span>
}
</code></pre></div><h2 id=full-example>Full Example</h2><p>Let&rsquo;s see a full example getting the stake distribution of all stake pools of the Cardano mainnet. In the example, we&rsquo;ll also use the <code>FindIntersect</code> method from the <a href=../local-chain-sync>local-chain-sync</a> protocol to get an easy point to acquire.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WebSocket</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ws&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#34;ws://localhost:1337&#34;</span>);

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>wsp</span>(<span style=color:#a6e22e>methodname</span>, <span style=color:#a6e22e>args</span>) {
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jsonwsp/request&#34;</span>,
        <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1.0&#34;</span>,
        <span style=color:#a6e22e>servicename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ogmios&#34;</span>,
        <span style=color:#a6e22e>methodname</span>,
        <span style=color:#a6e22e>args</span>
    }));
}

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>once</span>(<span style=color:#e6db74>&#39;open&#39;</span>, () =&gt; {
    <span style=color:#a6e22e>wsp</span>(<span style=color:#e6db74>&#34;FindIntersect&#34;</span>, { <span style=color:#a6e22e>points</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;origin&#34;</span>] });
});

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;message&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>msg</span>) {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>msg</span>);

    <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>methodname</span>) {
        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;FindIntersect&#34;</span><span style=color:#f92672>:</span>
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>point</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>IntersectionFound</span>.<span style=color:#a6e22e>tip</span>;
            <span style=color:#a6e22e>wsp</span>(<span style=color:#e6db74>&#34;Acquire&#34;</span>, { <span style=color:#a6e22e>point</span> });
            <span style=color:#66d9ef>break</span>;

        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;Acquire&#34;</span><span style=color:#f92672>:</span>
            <span style=color:#a6e22e>wsp</span>(<span style=color:#e6db74>&#34;Query&#34;</span>, { <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;stakeDistribution&#34;</span> });
            <span style=color:#66d9ef>break</span>;

        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;Query&#34;</span><span style=color:#f92672>:</span>
            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>result</span>);
            <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>close</span>();
            <span style=color:#66d9ef>break</span>;
    }
});
</code></pre></div><p>Here&rsquo;s a walk-though describing what happens when running the above script:</p><ol><li><p>An initial request ask to <code>FindIntersect</code> that is guaranteed to succeed is sent. This is a little trick in order to access the ledger tip easily. As a response, Ogmios replies with:</p><div class=expand><div class=expand-label style=cursor:pointer onclick="$h=$(this);$h.next('div').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('div').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right';});});"><i style=font-size:x-small class="fas fa-chevron-right"></i><span>IntersectionFound</span></div><div class=expand-content style=display:none><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>,
    <span style=color:#f92672>&#34;servicename&#34;</span>: <span style=color:#e6db74>&#34;ogmios&#34;</span>,
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;jsonwsp/response&#34;</span>,
    <span style=color:#f92672>&#34;methodname&#34;</span>: <span style=color:#e6db74>&#34;FindIntersect&#34;</span>,
    <span style=color:#f92672>&#34;result&#34;</span>: {
        <span style=color:#f92672>&#34;IntersectionFound&#34;</span>: {
            <span style=color:#f92672>&#34;point&#34;</span>: <span style=color:#e6db74>&#34;origin&#34;</span>,
            <span style=color:#f92672>&#34;tip&#34;</span>: {
                <span style=color:#f92672>&#34;hash&#34;</span>: <span style=color:#e6db74>&#34;dbafebb0146b2ec45186dfba6c287ad69c83d3fd9a186b39d99ab955631539e0&#34;</span>,
                <span style=color:#f92672>&#34;blockNo&#34;</span>: <span style=color:#ae81ff>4887546</span>,
                <span style=color:#f92672>&#34;slot&#34;</span>: <span style=color:#ae81ff>12526684</span>
            }
        }
    },
    <span style=color:#f92672>&#34;reflection&#34;</span>: <span style=color:#66d9ef>null</span>
}
</code></pre></div></div></div></li><li><p>Using the <code>tip</code> from the previous response, we can now safely <code>Acquire</code> a state on that particular tip which we know exists and is not too old. Ogmios replies successfully with:</p><div class=expand><div class=expand-label style=cursor:pointer onclick="$h=$(this);$h.next('div').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('div').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right';});});"><i style=font-size:x-small class="fas fa-chevron-right"></i><span>AcquireSuccess</span></div><div class=expand-content style=display:none><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>,
    <span style=color:#f92672>&#34;servicename&#34;</span>: <span style=color:#e6db74>&#34;ogmios&#34;</span>,
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;jsonwsp/response&#34;</span>,
    <span style=color:#f92672>&#34;methodname&#34;</span>: <span style=color:#e6db74>&#34;Acquire&#34;</span>,
    <span style=color:#f92672>&#34;result&#34;</span>: {
        <span style=color:#f92672>&#34;AcquireSuccess&#34;</span>: {
            <span style=color:#f92672>&#34;acquired&#34;</span>: {
                <span style=color:#f92672>&#34;hash&#34;</span>: <span style=color:#e6db74>&#34;dbafebb0146b2ec45186dfba6c287ad69c83d3fd9a186b39d99ab955631539e0&#34;</span>,
                <span style=color:#f92672>&#34;slot&#34;</span>: <span style=color:#ae81ff>12526684</span>
            }
        }
    },
    <span style=color:#f92672>&#34;reflection&#34;</span>: <span style=color:#66d9ef>null</span>
}
</code></pre></div></div></div></li><li><p>Now in a position to make an actual <code>Query</code>, we do it and ask for the stake distribution across all stake pools. The (truncated) response from the server looks like:</p><div class=expand><div class=expand-label style=cursor:pointer onclick="$h=$(this);$h.next('div').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('div').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right';});});"><i style=font-size:x-small class="fas fa-chevron-right"></i><span>QueryResponse</span></div><div class=expand-content style=display:none><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>,
    <span style=color:#f92672>&#34;servicename&#34;</span>: <span style=color:#e6db74>&#34;ogmios&#34;</span>,
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;jsonwsp/response&#34;</span>,
    <span style=color:#f92672>&#34;methodname&#34;</span>: <span style=color:#e6db74>&#34;Query&#34;</span>,
    <span style=color:#f92672>&#34;result&#34;</span>: {
        <span style=color:#f92672>&#34;pool1w3s6gk83y2g3670emy3yfjw9myz3u4whph7peah653rmsfegyj3&#34;</span>: {
            <span style=color:#f92672>&#34;stake&#34;</span>: <span style=color:#ae81ff>0</span>,
            <span style=color:#f92672>&#34;vrf&#34;</span>: <span style=color:#e6db74>&#34;29c1a293c550beea756bc0c01416bacd7030ae8992e13ca242d4d6c2aebaac0d&#34;</span>
        },
        <span style=color:#f92672>&#34;pool1n5shd9xdt4s2gm27fxcnuejaqhhmpepn6chw2c82kqnuzdtpsem&#34;</span>: {
            <span style=color:#f92672>&#34;stake&#34;</span>: <span style=color:#ae81ff>0.00003058882418046271</span>,
            <span style=color:#f92672>&#34;vrf&#34;</span>: <span style=color:#e6db74>&#34;7e363eb8bfd8fef018da4c397d6a6ec25998363434e92276e40ee6c706da3ae5&#34;</span>
        },
        <span style=color:#f92672>&#34;...&#34;</span>
    },
    <span style=color:#f92672>&#34;reflection&#34;</span>: <span style=color:#66d9ef>null</span>
}
</code></pre></div></div></div></li></ol><div class="notices warning"><p>Be aware that it is possible for an <code>Acquire</code> request to fail even if (and in particular if) made immediately after finding the ledger tip. In Ouroboros Praos frequent small rollbacks of the chain are not rare and the few last blocks of the chain can be a bit volatile. A real application may require more elaborate error handling than the toy example above.</p></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/mini-protocols/local-chain-sync/ title="Local Chain Sync"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/mini-protocols/local-tx-submission/ title="Local Tx Submission" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1627970201></script><script src=/js/perfect-scrollbar.min.js?1627970201></script><script src=/js/perfect-scrollbar.jquery.min.js?1627970201></script><script src=/js/jquery.sticky.js?1627970201></script><script src=/js/featherlight.min.js?1627970201></script><script src=/js/highlight.pack.js?1627970201></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1627970202></script><script src=/js/learn.js?1627970202></script><script src=/js/hugo-learn.js?1627970202></script></body></html>