<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.76.5"><meta name=description content="User manual for Ogmios, a lightweight protocol translation service for Cardano."><meta name=author content="KtorZ <matthias.benkort@gmail.com>"><link rel=icon href=/images/favicon.png type=image/png><title>Local Tx Monitor - Ogmios</title><link href=/css/nucleus.css?1656323012 rel=stylesheet><link href=/css/fontawesome-all.min.css?1656323012 rel=stylesheet><link href=/css/hybrid.css?1656323012 rel=stylesheet><link href=/css/featherlight.min.css?1656323012 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1656323012 rel=stylesheet><link href=/css/auto-complete.css?1656323012 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1656323012 rel=stylesheet><link href=/css/theme.css?1656323012 rel=stylesheet><link href=/css/tabs.css?1656323012 rel=stylesheet><link href=/css/hugo-theme.css?1656323012 rel=stylesheet><link href=/css/theme-mine.css?1656323012 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1656323012></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/mini-protocols/local-tx-monitor/><nav id=sidebar><div id=header-wrapper><div id=header><a href=/><img alt=ogmios src=/ogmios-logo-white.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1656323012></script><script type=text/javascript src=/js/auto-complete.js?1656323012></script><script type=text/javascript>var baseurl="https:\/\/ogmios.dev";</script><script type=text/javascript src=/js/search.js?1656323012></script></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/><b>1. </b>Getting Started</a><ul><li data-nav-id=/getting-started/docker/ title=Docker class=dd-item><a href=/getting-started/docker/>Docker</a></li><li data-nav-id=/getting-started/building/ title=Building class=dd-item><a href=/getting-started/building/>Building</a></li><li data-nav-id=/getting-started/testing/ title=Testing class=dd-item><a href=/getting-started/testing/>Testing</a></li><li data-nav-id=/getting-started/monitoring/ title=Monitoring class=dd-item><a href=/getting-started/monitoring/>Monitoring</a></li><li data-nav-id=/getting-started/basics/ title=Basics class=dd-item><a href=/getting-started/basics/>Basics</a></li></ul></li><li data-nav-id=/mini-protocols/ title="Ouroboros Mini-Protocols" class="dd-item
parent"><a href=/mini-protocols/><b>2. </b>Ouroboros Mini-Protocols</a><ul><li data-nav-id=/mini-protocols/local-chain-sync/ title="Local Chain Sync" class=dd-item><a href=/mini-protocols/local-chain-sync/>Local Chain Sync</a></li><li data-nav-id=/mini-protocols/local-state-query/ title="Local State Query" class=dd-item><a href=/mini-protocols/local-state-query/>Local State Query</a></li><li data-nav-id=/mini-protocols/local-tx-submission/ title="Local Tx Submission" class=dd-item><a href=/mini-protocols/local-tx-submission/>Local Tx Submission</a></li><li data-nav-id=/mini-protocols/local-tx-monitor/ title="Local Tx Monitor" class="dd-item active"><a href=/mini-protocols/local-tx-monitor/>Local Tx Monitor</a></li></ul></li><li data-nav-id=/deployment/ title=Deployment class=dd-item><a href=/deployment/><b>4. </b>Deployment</a><ul><li data-nav-id=/deployment/aws/ title=AWS class=dd-item><a href=/deployment/aws/>AWS</a></li></ul></li><li data-nav-id=/typescript-client/ title="TypeScript Client" class=dd-item><a href=/typescript-client/><b>4. </b>TypeScript Client</a><ul><li data-nav-id=/typescript-client/overview/ title=Overview class=dd-item><a href=/typescript-client/overview/>Overview</a></li><li data-nav-id=/typescript-client/chain-sync/ title="ChainSync Client" class=dd-item><a href=/typescript-client/chain-sync/>ChainSync Client</a></li><li data-nav-id=/typescript-client/state-query/ title="StateQuery Client" class=dd-item><a href=/typescript-client/state-query/>StateQuery Client</a></li><li data-nav-id=/typescript-client/tx-submission/ title="TxSubmission Client" class=dd-item><a href=/typescript-client/tx-submission/>TxSubmission Client</a></li><li data-nav-id=/typescript-client/tx-monitor/ title="TxMonitor Client" class=dd-item><a href=/typescript-client/tx-monitor/>TxMonitor Client</a></li></ul></li><li data-nav-id=/api/ title="API Reference" class=dd-item><a href=/api/><b>5. </b>API Reference</a></li><li data-nav-id=/changelog/ title=Changelog class=dd-item><a href=/changelog/><b>6. </b>Changelog</a></li><li data-nav-id=/faq/ title=F.A.Q class=dd-item><a href=/faq/><b>7. </b>F.A.Q</a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/cardanosolutions/ogmios><i class="fab fa-github"></i>Source code</a></li><li><a class=padding href=https://github.com/cardanosolutions/ogmios/issues><i class="fab fa-solid fa-bullseye"></i>Issues Tracking</a></li><li><a class=padding href=https://discord.gg/ZeyDn65t5v><i class="fab fa-discord"></i>Discord (#ogmios)</a></li><li><a class=padding href=https://github.com/CardanoSolutions/ogmios/tree/master/architectural-decisions/accepted><i class="fab fa-solid fa-file-code"></i>Architectural Decisions Record</a></li></ul></section><section id=footer><style>i.fa-solid{margin-left:-2px!important;margin-right:-2px!important}</style></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>Overview</a> > <a href=/mini-protocols/>Ouroboros Mini-Protocols</a> > Local Tx Monitor</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#retrieve-full-transactions>Retrieve Full Transactions</a></li></ul><ul><li><ul><li><a href=#about-transaction-locality>About Transaction Locality</a></li><li><a href=#about-transaction-observability>About Transaction Observability</a></li><li><a href=#about-transaction-status>About Transaction Status</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Local Tx Monitor</h1><div class="ascii-drawing ascii-drawing-split"><pre> 
                                START
                                  ⇓
                          ┌───────────────┐
                 ┌──────▶ │     Idle      │⇒ DONE 
                 │        └───────┬───────┘
                 │                │
                 │   AwaitAcquire │
                 │                │
                 │                ▼
                 │        ┌───────────────┐
  ReleaseMempool │        │   Acquiring   │
                 │        └───┬───────────┘
                 │            │       ▲
                 │   Acquired │       │ 
                 │            │       │ AwaitAcquire
                 │            ▼       │
                 │        ┌───────────┴───┐
                 └────────┤   Acquired    │
                          └───┬───────────┘
                              │       ▲
 HasTx|NextTx|SizeAndCapacity │       │ Reply (HasTx|NextTx|SizeAndCapacity)
                              ▼       │
                          ┌───────────┴───┐
                          │      Busy     │
                          └───────────────┘
 </pre></div><h1 id=overview>Overview</h1><p>To inspect the node&rsquo;s local mempool, one may rely on the local-tx-monitor mini-protocol. This protocol provides way to list all transactions sitting in the mempool, but also, to query the size of the mempool, the number of transactions currently in the mempool as well as the current capacity (based on network parameters).</p><p>As for the other mini-protocols, the local-tx-monitor is a stateful protocol with explicit state acquisition driven by the client. That is, clients must first acquire a mempool snapshot for running queries over it. Once acquired, queries are guaranteed to be consistent. In particular, <code>NextTx</code> will never yield twice the same transaction for the same snapshot and <code>SizeAndCapacity</code> will remain constant.</p><p><code>AwaitAcquire</code> is a blocking call. The server will only reply with <code>Acquired</code> once a <em>&ldquo;new&rdquo;</em> snapshot is available when <em>&ldquo;new&rdquo;</em> means different from the currently acquired snapshot. Seemingly, the first <code>AwaitAcquire</code> is instantaneous. This allows for clients to passively wait for changes without active polling. A typical pattern of usage would be to acquire a snapshot, list all transactions from the mempool via <code>NextTx</code> and then, block on <code>AwaitAcquire</code> for a change; then repeat.</p><h1 id=how-to-use>How To Use</h1><p>First, client must always acquire a snapshot and hold onto it for subsequent queries. To list all queries, one must call <code>NextTx</code> repeatedly until it yields <code>null</code>. So for instance, if the mempool currently contains three transactions <code>t0</code>, <code>t1</code> and <code>t2</code>, one can list all transactions from the mempool via the following sequence (schematically):</p><pre>
1. AwaitAcquire → Acquired
2. NextTx → NextTxResponse t0 
3. NextTx → NextTxResponse t1
4. NextTx → NextTxResponse t2 
5. NextTx → NextTxResponse null 
</pre><p>Another option is simply to query for a specific transaction via <code>HasTx</code>, which yields <code>True</code> or <code>False</code> depending on whether the transaction is currently in the mempool or not.</p><pre>
1. AwaitAcquire → Acquired
2. HasTx t0 → HasTxResponse True
3. HasTx t1 → HasTxResponse True
4. HasTx t5 → HasTxResponse False
</pre><p>At any moment, it is also possible to interleave a <code>SizeAndCapacity</code> query to get the acquired snapshot&rsquo;s size (in bytes), number of transactions and capacity (in bytes).</p><div class="notices tip"><p>The <em>capacity</em> refers to the maximum size of the mempool. It is currently defined as twice the network block size and can be adjusted via protocol updates.</p></div><h2 id=retrieve-full-transactions>Retrieve Full Transactions</h2><p>Since <code>5.3.0</code>, Ogmios can also return full transactions as a result of <code>NextTx</code>. This must be however explicitly requested from clients by providing an extra (optional) argument to each <code>NextTx</code> request:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{                                 
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;jsonwsp/request&#34;</span>,
    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>,
    <span style=color:#f92672>&#34;servicename&#34;</span>: <span style=color:#e6db74>&#34;ogmios&#34;</span>,
    <span style=color:#f92672>&#34;methodname&#34;</span>: <span style=color:#e6db74>&#34;NextTx&#34;</span>,
    <span style=color:#f92672>&#34;args&#34;</span>: {
        <span style=color:#f92672>&#34;fields&#34;</span>: <span style=color:#e6db74>&#34;all&#34;</span>
    }
}
</code></pre></div><p><code>"fields"</code> accept only one value (<code>"all"</code>) and can be omitted. When present, <code>NextTxResponse</code> will contain a full transaction as <code>"result"</code>. When omitted, the latter only contains a transaction id.</p><h1 id=important-notes>Important Notes</h1><p>Some important notes to keep in mind regarding the management of the mempool:</p><h3 id=about-transaction-locality>About Transaction Locality</h3><p>This protocol gives access to transactions that are submitted locally, by the connected client via the local-tx-submission protocol. In case of block producing nodes (i.e. stake pools), transactions pulled from peers may also be available.</p><h3 id=about-transaction-observability>About Transaction Observability</h3><p>The protocol <strong>does not</strong> guarantee observability of all transactions passing through the mempool. There&rsquo;s an inherent race condition between the client acquiring snapshots and the node managing it internally. Thus, while a client is holding a snapshot, it may still submit transactions through the local-tx-submission protocol, which may be accepted, processed and included in the ledger before the client next&rsquo;s <code>AwaitAcquire</code>. So, it is possible for clients to miss transactions passing through the mempool should they be concurrently submitting them.</p><h3 id=about-transaction-status>About Transaction Status</h3><p>Furthermore, while the presence of a transaction in the mempool qualifies it as pending, the absence of transactions in the mempool does not guarantee their inclusion in the ledger (transaction may be discarded from the mempool for various reasons). In particular, a <em>valid</em> transaction may leave the mempool to be included in a block which later result in a lost fork (e.g. because of a lost slot battle) and may never end up in the ledger. The node does not automatically re-insert transactions into the mempool.</p><h1 id=full-example>Full Example</h1><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WebSocket</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ws&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#34;ws://localhost:1337&#34;</span>);

<span style=color:#75715e>// Helper function
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>wsp</span>(<span style=color:#a6e22e>methodname</span>, <span style=color:#a6e22e>args</span>) {
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jsonwsp/request&#34;</span>,
        <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1.0&#34;</span>,
        <span style=color:#a6e22e>servicename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ogmios&#34;</span>,
        <span style=color:#a6e22e>methodname</span>,
        <span style=color:#a6e22e>args</span>
    }));
}

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;message&#39;</span>, <span style=color:#a6e22e>e</span> =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>next</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>e</span>).<span style=color:#a6e22e>result</span>;
  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>next</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) {
    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>close</span>();
  } <span style=color:#66d9ef>else</span> {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>next</span>);
    <span style=color:#a6e22e>wsp</span>(<span style=color:#e6db74>&#34;NextTx&#34;</span>);
  }
});

<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>once</span>(<span style=color:#e6db74>&#39;open&#39;</span>, () =&gt; {
    <span style=color:#a6e22e>wsp</span>(<span style=color:#e6db74>&#34;AwaitAcquire&#34;</span>);
});
</code></pre></div><h1 id=api-reference>API Reference</h1><p>The API reference will be available soon with the TypeScript client support.</p><p>Test vectors for <a href=https://github.com/CardanoSolutions/ogmios/tree/master/server/test/vectors/TxMonitor/Request>requests</a> and <a href=https://github.com/CardanoSolutions/ogmios/tree/master/server/test/vectors/TxMonitor/Response>responses</a> are available on the repository for testing, debugging and to serve as examples.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/mini-protocols/local-tx-submission/ title="Local Tx Submission"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/deployment/ title=Deployment style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1656323012></script><script src=/js/perfect-scrollbar.min.js?1656323012></script><script src=/js/perfect-scrollbar.jquery.min.js?1656323012></script><script src=/js/jquery.sticky.js?1656323012></script><script src=/js/featherlight.min.js?1656323012></script><script src=/js/highlight.pack.js?1656323012></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1656323012></script><script src=/js/learn.js?1656323012></script><script src=/js/hugo-learn.js?1656323012></script></body></html>