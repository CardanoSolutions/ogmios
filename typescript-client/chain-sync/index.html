<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.76.5"><meta name=description content="User manual for Ogmios, a lightweight protocol translation service for Cardano."><meta name=author content="KtorZ <matthias.benkort@gmail.com>"><link rel=icon href=/images/favicon.png type=image/png><title>ChainSync Client - Ogmios</title><link href=/css/nucleus.css?1638220060 rel=stylesheet><link href=/css/fontawesome-all.min.css?1638220060 rel=stylesheet><link href=/css/hybrid.css?1638220060 rel=stylesheet><link href=/css/featherlight.min.css?1638220060 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1638220060 rel=stylesheet><link href=/css/auto-complete.css?1638220060 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1638220060 rel=stylesheet><link href=/css/theme.css?1638220060 rel=stylesheet><link href=/css/hugo-theme.css?1638220060 rel=stylesheet><link href=/css/theme-mine.css?1638220060 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1638220060></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/typescript-client/chain-sync/><nav id=sidebar><div id=header-wrapper><div id=header><a href=/><img alt=ogmios src=/ogmios-logo-white.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1638220060></script><script type=text/javascript src=/js/auto-complete.js?1638220060></script><script type=text/javascript>var baseurl="https:\/\/ogmios.dev";</script><script type=text/javascript src=/js/search.js?1638220060></script></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/><b>1. </b>Getting Started</a><ul><li data-nav-id=/getting-started/docker/ title=Docker class=dd-item><a href=/getting-started/docker/>Docker</a></li><li data-nav-id=/getting-started/building/ title=Building class=dd-item><a href=/getting-started/building/>Building</a></li><li data-nav-id=/getting-started/testing/ title=Testing class=dd-item><a href=/getting-started/testing/>Testing</a></li><li data-nav-id=/getting-started/monitoring/ title=Monitoring class=dd-item><a href=/getting-started/monitoring/>Monitoring</a></li><li data-nav-id=/getting-started/basics/ title=Basics class=dd-item><a href=/getting-started/basics/>Basics</a></li></ul></li><li data-nav-id=/mini-protocols/ title="Ouroboros Mini-Protocols" class=dd-item><a href=/mini-protocols/><b>2. </b>Ouroboros Mini-Protocols</a><ul><li data-nav-id=/mini-protocols/local-chain-sync/ title="Local Chain Sync" class=dd-item><a href=/mini-protocols/local-chain-sync/>Local Chain Sync</a></li><li data-nav-id=/mini-protocols/local-state-query/ title="Local State Query" class=dd-item><a href=/mini-protocols/local-state-query/>Local State Query</a></li><li data-nav-id=/mini-protocols/local-tx-submission/ title="Local Tx Submission" class=dd-item><a href=/mini-protocols/local-tx-submission/>Local Tx Submission</a></li></ul></li><li data-nav-id=/deployment/ title=Deployment class=dd-item><a href=/deployment/><b>4. </b>Deployment</a><ul><li data-nav-id=/deployment/aws/ title=AWS class=dd-item><a href=/deployment/aws/>AWS</a></li></ul></li><li data-nav-id=/typescript-client/ title="TypeScript Client" class="dd-item
parent"><a href=/typescript-client/><b>3. </b>TypeScript Client</a><ul><li data-nav-id=/typescript-client/overview/ title=Overview class=dd-item><a href=/typescript-client/overview/>Overview</a></li><li data-nav-id=/typescript-client/chain-sync/ title="ChainSync Client" class="dd-item active"><a href=/typescript-client/chain-sync/>ChainSync Client</a></li><li data-nav-id=/typescript-client/state-query/ title="StateQuery Client" class=dd-item><a href=/typescript-client/state-query/>StateQuery Client</a></li><li data-nav-id=/typescript-client/tx-submission/ title="TxSubmission Client" class=dd-item><a href=/typescript-client/tx-submission/>TxSubmission Client</a></li></ul></li><li data-nav-id=/api-reference/ title="API Reference" class=dd-item><a href=/api-reference/><b>5. </b>API Reference</a></li><li data-nav-id=/changelog/ title=Changelog class=dd-item><a href=/changelog/><b>6. </b>Changelog</a></li><li data-nav-id=/faq/ title=F.A.Q class=dd-item><a href=/faq/><b>7. </b>F.A.Q</a></li></ul><section id=footer><center><a href=https://github.com/cardanosolutions/ogmios><i class="fab fa-github" style=font-size:3em></i></a></center></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>Overview</a> > <a href=/typescript-client/>TypeScript Client</a> > ChainSync Client</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#concurrent-vs-sequential>Concurrent vs sequential</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>ChainSync Client</h1><p>The ChainSync client streams block from the network, one-by-one in the form of events. Creating such a client requires your application to register two callbacks:</p><ul><li>on <code>rollForward</code>, to process new blocks coming in and advancing your local chain.</li><li>on <code>rollBackward</code>, to process rollback requests to a previous point of your local chain.</li></ul><div class="notices tip"><p>These callbacks are captured via the <a href=/api/interfaces/_cardano_ogmios_client.ChainSync.ChainSyncMessageHandlers.html>ChainSyncMessageHandlers</a> interface.</p></div><p>For example, you can store blocks into a <em>database</em> (assuming some high-level <code>db</code> interface) as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createChainSyncClient</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@cardano-ogmios/client&#39;</span>

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>rollForward</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>block</span> }, <span style=color:#a6e22e>requestNext</span>) <span style=color:#f92672>=&gt;</span> {
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>insert</span>(<span style=color:#a6e22e>block</span>)
  <span style=color:#a6e22e>requestNext</span>()
}

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>rollBackward</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>point</span> }, <span style=color:#a6e22e>requestNext</span>) <span style=color:#f92672>=&gt;</span> {
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>rollback</span>(<span style=color:#a6e22e>point</span>)
  <span style=color:#a6e22e>requestNext</span>()
}

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>createChainSyncClient</span>(<span style=color:#a6e22e>context</span>, { <span style=color:#a6e22e>rollForward</span>, <span style=color:#a6e22e>rollBackward</span> })

<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>startSync</span>()

<span style=color:#75715e>// ...
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>shutdown</span>()
</code></pre></div><p>Notice how the callback also includes a continuation <code>requestNext</code> which commands the server to send the next block. For more details about the chain-sync mini-protocol, have a look at <a href=mini-protocols/local-chain-sync/>the protocol documentation itself</a>.</p><p>Once created, the client offers two methods <code>startSync</code> and <code>shutdown</code>. As a matter of fact, the client does not start syncing automatically. This allows you to specify a starting point if necessary (in case your application is resuming from a previous state). This is optional and by default the client will synchronize from the node&rsquo;s tip and onward.</p><h3 id=concurrent-vs-sequential>Concurrent vs sequential</h3><p>By default, the client will send requests and process requests <em>sequentially</em> for it is more intuitive. However, some applications may not necessarily bother about sequentiality and may process messages in any order. This behavior can hence by changed by providing an extra option to <code>createChainSyncClient</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>createChainSyncClient</span>(<span style=color:#a6e22e>context</span>, <span style=color:#a6e22e>callbacks</span>, { <span style=color:#a6e22e>sequential</span>: <span style=color:#66d9ef>false</span> })
</code></pre></div><p>When <code>sequential</code> is set to <code>false</code>, the order in which message callbacks are resolved depends on the JavaScript runtime and whether or not your are making concurrent requests.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/typescript-client/overview/ title=Overview><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/typescript-client/state-query/ title="StateQuery Client" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1638220060></script><script src=/js/perfect-scrollbar.min.js?1638220060></script><script src=/js/perfect-scrollbar.jquery.min.js?1638220060></script><script src=/js/jquery.sticky.js?1638220060></script><script src=/js/featherlight.min.js?1638220060></script><script src=/js/highlight.pack.js?1638220060></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1638220060></script><script src=/js/learn.js?1638220060></script><script src=/js/hugo-learn.js?1638220060></script></body></html>